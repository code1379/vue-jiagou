{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export let activeEffect = undefined;\n\nfunction cleanupEffect(effect) {\n  // {name : set(effect)} \u5C5E\u6027\u5BF9\u5E94\u7684 effect\n\n  // \u627E\u5230 deps \u4E2D\u7684 set \u6E05\u7406\u6389 effect \u624D\u53EF\u4EE5\n  let deps = effect.deps;\n  for (let i = 0; i < deps.length; i++) {\n    deps[i].delete(effect);\n  }\n  effect.deps.length = 0;\n}\nclass ReactiveEffect {\n  public parent = undefined;\n\n  deps = []; // ! effect \u91CD\u8981\u8BB0\u5F55\u90A3\u4E9B\u5C5E\u6027\u5728 effect \u4E2D\u8C03\u7528\n  constructor(public fn) {}\n\n  run() {\n    // \u5F53\u8FD0\u884C\u7684\u65F6\u5019\uFF0C\u6211\u4EEC\u9700\u8981\u5C06\u5C5E\u6027\u548C\u5BF9\u5E94\u7684effect \u5173\u8054\u8D77\u6765\n    // \u5229\u7528js\u662F\u5355\u7EBF\u7A0B\u7684\u7279\u6027\uFF0C\u5148\u653E\u5728\u5168\u5C40\uFF0C\u518D\u53D6\u503C\n    try {\n      this.parent = activeEffect;\n      activeEffect = this;\n\n      cleanupEffect(this);\n      return this.fn(); // \u89E6\u53D1\u5C5E\u6027\u7684 get\n    } finally {\n      activeEffect = this.parent;\n    }\n  }\n}\n\n// \u5C5E\u6027\u548Ceffect\u4E4B\u95F4\u662F\u4EC0\u4E48\u5173\u7CFB\n// 1:1\n// 1:n\n// n:n\n\nexport function effect(fn) {\n  // \u5C06\u7528\u6237\u4F20\u9012\u7684\u51FD\u6570\uFF0C\u62FF\u5230\u53D8\u6210\u4E00\u4E2A\u54CD\u5E94\u5F0F\u51FD\u6570\n  const _effect = new ReactiveEffect(fn);\n  // \u9ED8\u8BA4\u8BA9\u7528\u6237\u7684\u51FD\u6570\u6267\u884C\u4E00\u6B21\n  _effect.run();\n}\n", "export function isObject(value: any) {\n  return typeof value === \"object\" && value !== null;\n}\n", "import { activeEffect } from \"./effect\";\n\nexport const enum ReactiveFlags {\n  \"IS_REACTIVE\" = \"__v_isReactive\",\n}\n// \u54CD\u5E94\u5F0F\u5BF9\u8C61\u7684\u6838\u5FC3\u903B\u8F91\nexport const mutableHandler = {\n  get(target, key, receiver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true;\n    }\n    // \u53D6\u503C\u7684\u65F6\u5019\u5173\u8054 effect\n    track(target, key);\n    return Reflect.get(target, key, receiver);\n  },\n  set(target, key, value, receiver) {\n    // \u8BBE\u7F6E\u503C\u7684\u65F6\u5019\u51FA\u53D1 effect\n    let oldVal = target[key];\n    let flag = Reflect.set(target, key, value, receiver);\n\n    if (value !== oldVal) {\n      trigger(target, key, value, oldVal);\n    }\n    return flag;\n  },\n};\n// Map = { ({name:\"dell\", age: 18}): name}\n// Map = { name: set()}\n// {name:\"dell\", age: 18} -> name  => [effect, effect]\nconst targetMap = new WeakMap();\n\nfunction track(target, key) {\n  if (activeEffect) {\n    // \u5F53\u524D\u8FD9\u4E2A\u5C5E\u6027\u662F\u5728effect\u4E2D\u4F7F\u7528\u624D\u6536\u96C6\n    let depsMap = targetMap.get(target);\n\n    if (!depsMap) {\n      targetMap.set(target, (depsMap = new Map()));\n    }\n\n    let dep = depsMap.get(key);\n\n    if (!dep) {\n      depsMap.set(key, (dep = new Set()));\n    }\n\n    let shouldTrack = !dep.has(activeEffect);\n    if (shouldTrack) {\n      dep.add(activeEffect);\n\n      activeEffect.deps.push(dep); // \u8FD9\u91CC\u8BA9 effect \u4E5F\u8BB0\u5F55\u4E00\u4E0B deps = [ name => set1, age => set2 ]\n    }\n  }\n}\n\nfunction trigger(target, key, value, oldValue) {\n  // \u627E\u5230 effect \u6267\u884C\n  const depsMap = targetMap.get(target);\n  if (!depsMap) {\n    return;\n  }\n\n  const effects = depsMap.get(key);\n\n  if (effects) {\n    [...effects].forEach((effect) => {\n      // \u5F53\u524D\u6B63\u5728\u6267\u884C\u7684\u548C\u73B0\u5728\u662F\u540C\u4E00\u4E2A\uFF0C\u5C31\u5C4F\u853D\u6389\n      if (effect !== activeEffect) {\n        effect.run();\n      }\n    });\n  }\n}\n", "import { isObject } from \"@vue/shared\";\nimport { ReactiveFlags, mutableHandler } from \"./baseHandler\";\n\nexport function reactive(target) {\n  return createReactiveObject(target);\n}\n\nconst reactiveMap = new WeakMap(); // \u9632\u6B62\u5185\u5B58\u6CC4\u9732\n\nfunction createReactiveObject(target) {\n  if (!isObject(target)) {\n    return;\n  }\n  // 2. \u9632\u6B62\u4F20\u9012\u8FDB\u6765\u7684\u662F\u4EE3\u7406\u540E\u7684\u5BF9\u8C61\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target;\n  }\n\n  // 1. \u9632\u6B62\u540C\u4E00\u4E2A\u5BF9\u8C61\u88AB\u4EE3\u7406\u4E24\u6B21\uFF0C\u8FD4\u56DE\u7684\u6C38\u8FDC\u662F\u540C\u4E00\u4E2A\u4EE3\u7406\u5BF9\u8C61\n  let existingProxy = reactiveMap.get(target);\n  if (existingProxy) {\n    return existingProxy;\n  }\n  const proxy = new Proxy(target, mutableHandler);\n  reactiveMap.set(target, proxy);\n  // \u4EE3\u7406\u524D \u4EE3\u7406\u540E\u505A\u4E00\u4E2A\u6620\u5C04\u8868\n  // \u5982\u679C\u7528\u540C\u4E00\u4E2A\u5BF9\u8C61\u505A\u4EE3\u7406\uFF0C\u76F4\u63A5\u8FD4\u56DE\u4E0A\u4E00\u6B21\u7684\u4EE3\u7406\u7ED3\u679C\n  return proxy;\n}\n"],
  "mappings": ";AAAO,IAAI,eAAe;AAE1B,SAAS,cAAcA,SAAQ;AAI7B,MAAI,OAAOA,QAAO;AAClB,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACpC,SAAK,CAAC,EAAE,OAAOA,OAAM;AAAA,EACvB;AACA,EAAAA,QAAO,KAAK,SAAS;AACvB;AACA,IAAM,iBAAN,MAAqB;AAAA;AAAA,EAInB,YAAmB,IAAI;AAAJ;AAHnB,SAAO,SAAS;AAEhB,gBAAO,CAAC;AAAA,EACgB;AAAA,EAExB,MAAM;AAGJ,QAAI;AACF,WAAK,SAAS;AACd,qBAAe;AAEf,oBAAc,IAAI;AAClB,aAAO,KAAK,GAAG;AAAA,IACjB,UAAE;AACA,qBAAe,KAAK;AAAA,IACtB;AAAA,EACF;AACF;AAOO,SAAS,OAAO,IAAI;AAEzB,QAAM,UAAU,IAAI,eAAe,EAAE;AAErC,UAAQ,IAAI;AACd;;;AC3CO,SAAS,SAAS,OAAY;AACnC,SAAO,OAAO,UAAU,YAAY,UAAU;AAChD;;;ACIO,IAAM,iBAAiB;AAAA,EAC5B,IAAI,QAAQ,KAAK,UAAU;AACzB,QAAI,QAAQ,oCAA2B;AACrC,aAAO;AAAA,IACT;AAEA,UAAM,QAAQ,GAAG;AACjB,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC1C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAEhC,QAAI,SAAS,OAAO,GAAG;AACvB,QAAI,OAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAEnD,QAAI,UAAU,QAAQ;AACpB,cAAQ,QAAQ,KAAK,OAAO,MAAM;AAAA,IACpC;AACA,WAAO;AAAA,EACT;AACF;AAIA,IAAM,YAAY,oBAAI,QAAQ;AAE9B,SAAS,MAAM,QAAQ,KAAK;AAC1B,MAAI,cAAc;AAEhB,QAAI,UAAU,UAAU,IAAI,MAAM;AAElC,QAAI,CAAC,SAAS;AACZ,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC7C;AAEA,QAAI,MAAM,QAAQ,IAAI,GAAG;AAEzB,QAAI,CAAC,KAAK;AACR,cAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,IACpC;AAEA,QAAI,cAAc,CAAC,IAAI,IAAI,YAAY;AACvC,QAAI,aAAa;AACf,UAAI,IAAI,YAAY;AAEpB,mBAAa,KAAK,KAAK,GAAG;AAAA,IAC5B;AAAA,EACF;AACF;AAEA,SAAS,QAAQ,QAAQ,KAAK,OAAO,UAAU;AAE7C,QAAM,UAAU,UAAU,IAAI,MAAM;AACpC,MAAI,CAAC,SAAS;AACZ;AAAA,EACF;AAEA,QAAM,UAAU,QAAQ,IAAI,GAAG;AAE/B,MAAI,SAAS;AACX,KAAC,GAAG,OAAO,EAAE,QAAQ,CAACC,YAAW;AAE/B,UAAIA,YAAW,cAAc;AAC3B,QAAAA,QAAO,IAAI;AAAA,MACb;AAAA,IACF,CAAC;AAAA,EACH;AACF;;;ACrEO,SAAS,SAAS,QAAQ;AAC/B,SAAO,qBAAqB,MAAM;AACpC;AAEA,IAAM,cAAc,oBAAI,QAAQ;AAEhC,SAAS,qBAAqB,QAAQ;AACpC,MAAI,CAAC,SAAS,MAAM,GAAG;AACrB;AAAA,EACF;AAEA,MAAI,yCAAgC,GAAG;AACrC,WAAO;AAAA,EACT;AAGA,MAAI,gBAAgB,YAAY,IAAI,MAAM;AAC1C,MAAI,eAAe;AACjB,WAAO;AAAA,EACT;AACA,QAAM,QAAQ,IAAI,MAAM,QAAQ,cAAc;AAC9C,cAAY,IAAI,QAAQ,KAAK;AAG7B,SAAO;AACT;",
  "names": ["effect", "effect"]
}
